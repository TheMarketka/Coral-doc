%!TEX TS-program = xelatex
%!TEX encoding = UTF-8 Unicode

\chapter{Readers}
\label{sec:environment-readers}

Amlantis System provides multiple interfaces to talk to it with. Those interfaces would be:

\begin{itemize}
  \item A REPL console, where user's text input is immediately read, evaluated, printed and requested again.
  \item Source code, where user's text input is stored for reuse in general, usually to either do some scripting, or building modules and complex applications. 
  \item Bytecode or native (machine) code files, which originate from textual source code.
\end{itemize}

More ways to interact with the Amlantis System might be possible in the future.\footnote{Some ideas for that would include natural speech interface (at least in English).}

Either way, for now, text-based interface to all Amlantis System tools require it to have a component that is able to read the text. We call them {\em Readers}.

Every Reader needs a source port to read from. Such a port could be console input for the REPL, a file on local filesystem, a TCP connection, socket, or just an in-memory string\footnote{More about strings later.}. Reading program source starts with a top-most Reader, which we may call the {\em Root Reader}. Such Reader does not know about which language it is reading (whereas recursively-descendent created Readers may inherit such knowledge), so we say it is reading in a {\em language-less mode}.

The Root Reader's \lstinline!read-program! method is used on the top-most initial port.\footnote{Might be different in future, when we allow it to use \lstinline!read! instead. That is not very useful now though.}

% TODO: specify how the read-program is called, what are its arguments?



\newpage

\section{Language-less Root Reader Abilities}

The language-less Root Reader can recognise basic delimiters, such as all whitespace and newlines. 

Delimited by these, it can recognise the following forms:

\begin{itemize}
  \item Shebang, such as \lstinline@#!/usr/bin/env aml@, to point to the entry-level Amlantis System tool.
  \item Reader switch, \lstinline@#reader $name$ $\ldots$@, which specifies a reader to use for the following forms, and switches to it. The $name$ should be a simple identifier.\footnote{Specification for identifiers will be provided later.}
  \item Language switch, \lstinline@#lang $name$ $\ldots$@, which expands right away into \lstinline@#reader $name$.Lang.Reader $\ldots$@.\footnote{It may expand to other forms as well in certain order, due to be defined later.} The $name$ should be a simple identifier.\footnote{Specification for identifiers will be provided later.}
\end{itemize}

% TODO: specify simple identifiers!

For now, that's it. In the next iteration, the list may include line comments or alias for \lstinline@#lang@ in order to support languages such as R\textsuperscript{6}RS.

The language-less Root Reader should not be accessible from user's programs directly, hence we define no system name for it.





