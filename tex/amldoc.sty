%!TEX TS-program = xelatex
%!TEX encoding = UTF-8 Unicode

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{amldoc}[2014/04/20 v0.3 Aml style customization]

\RequirePackage{fourier}
\usepackage[a4paper]{geometry}
\usepackage{mathspec,xltxtra,xunicode,xspace,titling,ifpdf}
\RequirePackage{color}
\RequirePackage{colortbl}
\usepackage[usenames,dvipsnames]{xcolor}

\RequirePackage{a4}
\setlength{\textheight}{22.5cm}

% fancy headings
\RequirePackage[clearempty]{titlesec}

\newcommand{\docversion}{unknown}
\renewcommand{\maketitlehookb}{\begin{center} {\large Version \docversion}\end{center}}

\newcommand{\mychaptername}{Chapter}
\titleformat{name=\chapter}
   [display]
   {\sffamily\bfseries\Huge}%
   {\textnormal{\chapterfont\Large\mychaptername{} \thechapter}}%
   {0pt}%
   {\vspace*{2.5mm}}%
   [\vspace*{8mm}]%
\titleformat{name=\chapter,numberless}%
   [display]%
   {\vspace*{-30mm}\sffamily\bfseries\Large}%
   {}%
   {0pt}%
   {}%
   [\vspace*{2mm}]%
\titleformat{name=\section}
   {\sffamily\bfseries\huge}
   {\thesection}
   {1em}
   {}
\titlespacing{\section}{0pt}{*4}{*2}
\titleformat{name=\subsection}
   {\sffamily\bfseries\Large}
   {\thesubsection}
   {0.67em}
   {}
\titlespacing{\subsection}{0pt}{*2}{*1}
\titleformat{name=\subsubsection}
   {\sffamily\bfseries\large}
   {\thesubsubsection}
   {0.55em}
   {}
\titleformat{name=\paragraph}
   [runin]
   {\rmfamily\normalsize\bfseries}
   {}
   {opt}
   {}
   [.\ ]
\titleformat{name=\subparagraph}
   [runin]
   {\itshape}
   {}
   {0pt}
   {}
   [.\ ]
\addtocounter{secnumdepth}{1}
\setcounter{tocdepth}{3}

% fancy footers
\RequirePackage[bottom,multiple,stable]{footmisc}

% fancy headers
\RequirePackage{fancyhdr}
\pagestyle{fancy}
\fancypagestyle{plain}{\fancyhf{}%
   \renewcommand{\headrulewidth}{0pt}%
   \renewcommand{\footrulewidth}{0pt}}

\RequirePackage{hyperref}

\makeatletter
%%%
\@ifundefined{chaptermark}{}{\renewcommand{\chaptermark}[1]{\markboth{#1}{}}}
%%%
\makeatother
%%%
\renewcommand{\sectionmark}[1]{\markright{\thesection\ \ #1}}
\fancyhf{}
\fancyhead[LE,RO]{\sffamily\footnotesize\thepage}
\fancyhead[RE]{\sffamily\footnotesize\leftmark}
\fancyhead[LO]{\sffamily\footnotesize\rightmark}
\renewcommand{\headrulewidth}{0.5pt}

% set up typefaces
\defaultfontfeatures{Mapping=tex-text}
\setmainfont[Scale=0.9,Mapping=tex-text,ItalicFont=Linux Libertine Italic,BoldFont=Linux Libertine Bold,BoldItalicFont=Linux Libertine Bold Italic]{Linux Libertine Display}
\setromanfont[Scale=0.9,Mapping=tex-text,ItalicFont=Linux Libertine Italic,BoldFont=Linux Libertine Bold,BoldItalicFont=Linux Libertine Bold Italic]{Linux Libertine Display}
\setsansfont[Scale=MatchLowercase,Mapping=tex-text]{Linux Biolinum}%{Helvetica Neue Condensed Bold}
% retrieve at: https://github.com/belluzj/fantasque-sans
%\setmonofont[Scale=MatchLowercase,Mapping=]{Fantasque Sans Mono}
% retrieve at: http://sourcefoundry.org/hack/
\setmonofont[Scale=MatchLowercase,Mapping=]{Hack}
\setmathfont(Digits,Latin,Greek)[Scale=MatchLowercase,ItalicFont=Linux Libertine Italic,BoldFont=Linux Libertine Bold,BoldItalicFont=Linux Libertine Bold Italic]{Linux Libertine Display}
\newfontfamily\headingfont[]{Linux Biolinum}%{Helvetica Neue Condensed Bold}
\newfontfamily\chapterfont[]{Linux Biolinum}%{Helvetica Neue Thin}
\renewcommand{\maketitlehooka}{\headingfont}
\setlength{\parindent}{0pt}
\setlength{\parskip}{8pt plus 2pt minus 2pt}

% customize font sizes
\makeatletter
\renewcommand\Huge{\@setfontsize\Huge{28pt}{30}}
\renewcommand\huge{\@setfontsize\huge{22pt}{24}}
\renewcommand\Large{\@setfontsize\Large{18pt}{20}}
\makeatother

\usepackage{listings}

\lstdefinelanguage[ExtraComments]{Aml}{
  morecomment=[l]\#!,%
  morecomment=[l]--,%
  morecomment=[n]{\{-}{-\}},%
}[comments]%

\lstdefinelanguage{Aml}{
  alsoletter={-!?},%
  morekeywords={%
    abstract,%
    advice,%
    after,%
    alias,%
    all,%
    also,%
    and,%
    annotation,%
    arguments,%
    around,%
    as,%
    as?,%
    as!,%
    aspect,%
    assert,%
    attribute,%
    begin,%
    before,%
    break,%
    broken,%
    by,%
    case,%
    catch,%
    class,%
    cloned,%
    constant,%
    constraint,%
    constructor,%
    convenience,%
    declare,%
    defer,%
    delta,%
    destructor,%
    did,%
    digits,%
    dispatch,%
    do,%
    do!,%
    done,%
    down,%
    downcast,%
    eager,%
    else,%
    end,%
    ensure,%
    enum,%
    eval,%
    execution,%
    exhausted,%
    exit,%
    extension,%
    family,%
    failure,%
    final,%
    for,%
    foreign,%
    fun,%
    function,%
    functor,%
    get,%
    given,%
    global,%
    goto,%
    handle,%
    handler,%
    if,%
    implicit,%
    immutable,%
    in,%
    include,%
    infix,% infix non-associative
    infixl,% infix left-associative
    infixr,% infix right-associative
    inherit,%
    instance,%
    interface,%
    invariant,%
    invoke,%
    is,%
    is!,%
    joinpoint,%
    label,%
    lazy,%
    let,%
    let?,%
    let!,%
    local,%
    loop,%
    macro,%
    match,%
    measure,%
    memoize,%
    message,%
    method,%
    module,%
    multi,%
    mutable,%
    native,%
    new,%
    next,%
    nil,%
    no,%
    nonfix,%
    not,%
    not!,%
    object,%
    of,%
    opaque,%
    open,%
    open!,%
    operator,%
    optional,%
    or,%
    otherwise,%
    out,%
    outer,%
    override,%
    parallel,%
    per-self,%
    per-target,%
    pointcut,%
    pragma,%
    prefer,%
    private,%
    property,%
    protected,%
    protocol,%
    public,%
    pure,%
    raise,%
    raises,%
    raising,%
    range,%
    rec,%
    recursive,%
    redo,%
    ref,%
    refinement,%
    reflect,%
    release,%
    reraise,%
    reraises,%
    rescue,%
    resignal,%
    resignals,%
    retain,%
    rethrow,%
    rethrows,%
    retry,%
    return,%
    return!,%
    returning,%
    returns,%
    required,%
    scope,%
    sealed,%
    self,%
    set,%
    seq,%
    sig,%
    signal,%
    signalling,%
    signals,%
    signature,%
    skip,%
    some,%
    step,%
    struct,%
    structure,%
    success,%
    super,%
    switch,%
    synchronized,%
    tailcall,%
    target,%
    then,%
    throw,%
    throwing,%
    throws,%
    to,%
    trait,%
    transparent,%
    try,%
    try?,%
    try!,%
    type,%
    undefined,%
    unless,%
    unowned,%
    until,%
    up,%
    upcast,%
    use,%
    use!,%
    val,%
    val?,%
    var,%
    var?,%
    variant,%
    yes,%
    weak,%
    when,%
    where,%
    while,%
    will,%
    with,%
    without,%
    xor,%
    yield,%
    yield!,%
    yielding},%
  sensitive,%
  morecomment=[l]--,%
  morecomment=[n]{\{-}{-\}},%
}[keywords,comments]

% activate the language and predefine settings
\lstset{
    language=Aml,%
    xleftmargin=4mm,%
    aboveskip=4mm,%
    belowskip=4mm,%
    fontadjust=true,%
    columns=[c]fixed,%
    keepspaces=true,%
    basewidth={0.58em, 0.53em},%
    tabsize=2,%
    basicstyle=\renewcommand{\baselinestretch}{0.95}\ttfamily,%
    commentstyle=\itshape\color{gray},%
    keywordstyle=\bfseries,%
    mathescape=true,%
    captionpos=b,%
    framerule=0.3pt,%
    firstnumber=0,%
    numbersep=1.5mm,%
    numberstyle=\tiny,%
    escapeinside={(*@}{@*)},%
    inputencoding=utf8,%
}

\newcommand{\code}[1]{%
    \lstinline[%keywordstyle=,%
               flexiblecolumns=true,%
               basicstyle=\ttfamily]£#1£}

\usepackage{multicol}
\usepackage{multirow}
\usepackage{array}
\usepackage{booktabs}
\usepackage[justification=justified,singlelinecheck=false]{caption}
\usepackage{minitoc}
\setcounter{minitocdepth}{3}

\newcommand{\clearemptydoublepage}{\newpage{\pagestyle{empty}\cleardoublepage}}

\newcommand{\syntax}{{\bf Syntax:}}
\newcommand{\grammar}{{\bf Grammar:}}
\newcommand{\sref}[1]{\S\ref{#1}}
\newcommand{\comma}{,\,}
\newcommand{\commadots}{\comma \ldots \comma}
\newcommand{\conforms}{\ifmmode \mathtt{\ <:\ } \else <: \fi}
\newcommand{\gap}{\quad\quad}

\newcounter{Example}[section]
\newcounter{result}[section]

\def\example{
   \def\theresult{Example~\thesection.\arabic{result}}
   \refstepcounter{result}
   \trivlist\item[\hskip
   \labelsep{\bf \theresult}]}
\def\endexample{\endtrivlist}

\def\definition{
   \def\theresult{Definition~\thesection.\arabic{result}}
   \refstepcounter{result}
   \trivlist\item[\hskip
   \labelsep{\bf \theresult}]}
\def\enddefinition{\endtrivlist}

\newcommand{\ba}{\begin{array}}
\newcommand{\ea}{\end{array}}
\newcommand{\bda}{\[\ba}
\newcommand{\eda}{\ea\]}
\newcommand{\Dollar}{\mbox{\$}}

\newcommand{\stats}{\mbox{\sl stats}}
\newcommand{\args}{\mbox{\sl args}}
\newcommand{\targs}{\mbox{\sl targs}}
\newcommand{\cas}{\mbox{\sl cas}}
\newcommand{\as}{\mbox{\sl as}}
\newcommand{\tps}{\mbox{\sl tps}}
\newcommand{\ps}{\mbox{\sl ps}}
\newcommand{\Ts}{\mbox{\sl Ts}}
\newcommand{\Tp}{\mbox{\sl Tp}}
\newcommand{\op}{\mbox{\sl op}}
\newcommand{\psig}{\mbox{\sl psig}}
\newcommand{\shape}{\mbox{\sl shape}}
\newcommand{\enums}{\mbox{\sl enums}}
\newcommand{\digits}{\mbox{\sl digits}}
\newcommand{\fpdelta}{\mbox{\sl delta}}
\newcommand{\id}{\mbox{\sl id}}
\newcommand{\weight}{\mbox{\sl weight}}
\newcommand{\pweight}{\mbox{\sl pweight}}
\newcommand{\cweight}{\mbox{\sl cweight}}
\newcommand{\rweight}{\mbox{\sl rweight}}
\newcommand{\tpweight}{\mbox{\sl tpweight}}
\newcommand{\exptype}{\mbox{\sl et}}
\newcommand{\udef}{\mbox{\sl undefined}}
\newcommand{\superth}{\mbox{\scriptsize th}}

\newcommand{\Aml}{\lstinline!Aml!\xspace}
\newcommand{\AmlCore}{\lstinline!Aml/Core!\xspace}
\newcommand{\AmlSystem}{\lstinline!Aml/System!\xspace}
\newcommand{\AmlSharp}{\mbox{\lstinline!Aml\#!}\xspace}
\newcommand{\AmlSharpSystem}{\mbox{\lstinline!Aml\#/System!}\xspace}
\newcommand{\AmlSE}{\lstinline!Aml/SE!\xspace}
\newcommand{\SharpSign}{\textsuperscript{\symbol{"266F}}\xspace}
\newcommand{\AmlSharpTitle}{Amlantis{\normalfont \SharpSign}\xspace}





